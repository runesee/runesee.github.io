<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="./android.css" />
    <link rel="icon" type="image/x-icon" href="images/duck/duck_full.png" />
    <title>Portfolio - runesee</title>
  </head>
  <body>
    <div id="screen">
      <div id="weather-widget">
        <div id="weather-content">
          <img />
          <h1 id="weather-temperature">Fetching temperature...</h1>
          <h3>Trondheim</h3>
        </div>
      </div>
    </div>

    <div id="weather">Loading weather...</div>

    <script>
      async function fetchWeather() {
        try {
          const response = await fetch("./data/weather.json");
          if (!response.ok) throw new Error("Could not load cached weather");

          const data = await response.json();
          const now = new Date();
          const timeseries = data.properties.timeseries;

          let closest = timeseries[0];
          let minDiff = Infinity;

          for (const entry of timeseries) {
            const entryTime = new Date(entry.time);
            const diff = Math.abs(entryTime - now);
            if (diff < minDiff) {
              minDiff = diff;
              closest = entry;
            }
          }

          const temp = closest.data.instant.details.air_temperature;
          const symbol =
            closest.data.next_1_hours?.summary?.symbol_code || "unknown";

          document.getElementById("weather").innerHTML = `
      <h2>Trondheim</h2>
      <p><strong>${temp} Â°C</strong></p>
    `;
        } catch (err) {
          console.error(err);
          document.getElementById("weather").textContent =
            "Weather unavailable.";
        }
      }

      fetchWeather();
    </script>
  </body>
</html>
