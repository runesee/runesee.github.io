<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="./android.css" />
    <link rel="icon" type="image/x-icon" href="../images/duck/duck_full.png" />
    <title>Portfolio - runesee</title>
  </head>
  <body>
    <div id="screen">
      <div id="weather-widget">
        <div id="weather-content">
          <img id="weather-icon" />
          <h1 id="weather-temperature">? °C</h1>
          <h2>Trondheim</h2>
        </div>
      </div>
    </div>

    <script>
      async function fetchWeather() {
        try {
          const response = await fetch("../data/weather.json");
          if (!response.ok) throw new Error("Could not load cached weather");

          const data = await response.json();
          const now = new Date();
          const timeseries = data.properties.timeseries;

          let closest = timeseries[0];
          let minDiff = Infinity;

          for (const entry of timeseries) {
            const entryTime = new Date(entry.time);
            const diff = Math.abs(entryTime - now);
            if (diff < minDiff) {
              minDiff = diff;
              closest = entry;
            }
          }

          const temp = closest.data.instant.details.air_temperature;
          const symbol =
            closest.data.next_1_hours?.summary?.symbol_code || "unknown";

          document.getElementById(
            "weather-temperature"
          ).innerHTML = `<h1 id="weather-temperature">${temp} °C</h1>`;
          document.getElementById("weather-icon").src =
            "../images/an/" + String(symbol) + ".png";
        } catch (err) {
          console.error(err);
          document.getElementById(
            "weather-temperature"
          ).innerHTML = `<h1 id="weather-temperature">? °C</h1>`;
        }
      }
      fetchWeather();
    </script>
  </body>
</html>
