<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="./android.css" />
    <link rel="icon" type="image/x-icon" href="../images/duck/duck_full.png" />
    <title>Portfolio - runesee</title>
  </head>
  <body>
    <div id="screen">
      <div id="topbar">
        <h2 id="topbar-time"></h2>
      </div>
      <div id="weather-widget">
        <div id="weather-content">
          <img id="weather-icon" />
          <h1 id="weather-temperature">? °C</h1>
          <h2>Trondheim</h2>
        </div>
      </div>
    </div>

    <script>
      function updateClock() {
        let date = new Date();
        let clock = document.getElementById("topbar-time");
        let hours = String(date.getHours()).padStart(2, "0");
        let minutes = String(date.getMinutes()).padStart(2, "0");
        clock.innerText = `${hours}:${minutes}`;
      }

      function startClock() {
        updateClock();
        let date = new Date();
        let delay =
          60_000 - (date.getSeconds() * 1000 + date.getMilliseconds());

        setTimeout(() => {
          updateClock();
          setInterval(updateClock, 60_000);
        }, delay);
      }

      async function fetchWeather() {
        try {
          const response = await fetch("../data/weather.json");
          if (!response.ok) throw new Error("Could not load weather data");

          const data = await response.json();
          const now = new Date();
          const timeseries = data.properties.timeseries;

          let closest = timeseries[0];
          let minDiff = Infinity;

          for (const entry of timeseries) {
            const entryTime = new Date(entry.time);
            const diff = Math.abs(entryTime - now);
            if (diff < minDiff) {
              minDiff = diff;
              closest = entry;
            }
          }

          const temp = closest.data.instant.details.air_temperature;
          const symbol =
            closest.data.next_1_hours?.summary?.symbol_code || "unknown";

          document.getElementById("weather-temperature").innerText =
            String(temp) + " °C";
          document.getElementById("weather-icon").src =
            "../images/an/" + String(symbol) + ".png";
        } catch (err) {
          console.error(err);
          document.getElementById("weather-temperature").innerText = "? °C";
        }
      }
      startClock();
      fetchWeather();
    </script>
  </body>
</html>
